<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Opening form</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/> -->
    <style>
        .form-grid {
          display: grid;
          grid-template-columns: repeat(3, 1fr);
          gap: 1rem;
          max-width: 900px;
          margin: auto;
        }
        .modal-content {
            display: grid;
            grid-template-columns: auto;
            margin: auto;
        }
      
        .form-group {
          display: flex;
          flex-direction: column;
        }
      
        label {
          margin-bottom: 4px;
          font-weight: bold;
        }
        
        input[type="text"], select {
          padding: 6px;
          font-size: 1rem;
          /* text-transform: uppercase; */
        }

        input[type="date"], input[type="email"], select {
            padding: 6px;
            font-size: 1rem;
        }

            input:invalid {
      border: 2px solid red;
    }

    input:valid {
      border: 2px solid #808080;
    }

    .error-message {
      color: red;
      font-size: 0.9em;
      display: none;
    }

    input:invalid + .error-message {
      display: block;
    }

    label {
      display: block;          /* labels are inline by default */
      text-align: left;      /* center the text inside the label */
      margin-left: 8px;
    }
    .ok { color: green; }
    .err { color: red; }
    .muted { color: gray; }
        
      </style>
</head>
<body>
    <form id="accountForm">
        <div id="welcomeModal" class="modal-content">
            <div class="modal-content">
              <h4>Welcome!</h4>
              <p>We're thrilled to have you here. This is created and designed by Sedhupathi A (New Sr.No. 778342).</p>
              <p>If you have any suggestions feel free to contact in whatsapp (+91 9629677605) or email (sedhupathi22@gmail.com).</p>
            </div>
          </div>
        </div>
        <div class="form-grid">
            <!-- <label for="aadhaarQr">QR.</label> -->
            <textarea id="aadhaar_decimal_1" rows="2" placeholder="Paste here.."></textarea>
            <!-- <small id="qrStatus" class="status muted" style="display:block;margin-top:4px;color:#666">Waiting…</small> -->

          <!-- <input type="text"  data-field="qr" placeholder="Qr code paste here"/>
          <div class="status muted">Please paste here</div> -->
            <!-- <input type="text" id="aadhaar_decimal_1" placeholder="QR code number only...">
            <input type="text" id="aadhaar_xml_1" placeholder="Paste other than number here...">
            <div id="status_1" class="status muted">QR.</div> -->
            <div class="form-group">
                <label for="application_type">Application Type:</label>
                <select id="application_type" name="applicationType" required>
                    <option value="">--Select Type--</option>
                    <option selected value="NEW">NEW</option>
                    <option value="UPDATE">UPDATE</option>
                </select>
            </div>
            <div class="form-group">
                <label for="branch_name">Branch Name:</label>
                <input type="text" name="branchName" placeholder="Branch Name">
            </div>
            <div class="form-group">
                <label for="branch_code">Branch Code:</label>
                <input type="text" name="branchCode" placeholder="Branch Code">
            </div>
            <div class="form-group">
                <label for="cif_no">CIF No:</label>
                <input type="text" name="cifNo" placeholder="CIF No. if already opened account">
            </div>
            <div class="form-group">
                <label for="account_no">Acc No.:</label>
                <input type="text" name="accNo" placeholder="ACC No. if already opened account">
            </div>
            <div class="form-group">
                <label for="name">Customer Name:</label>
                <input type="text" id="name_1" name="customerName" placeholder="Name">
            </div>
            <div class="form-group">
                <label for="Gender">Gender:</label>
                <select id="gender_1" name="gender" required>
                <option disabled="" selected="" value="">Gender</option>
                <option value="MALE">MALE</option>
                <option value="FEMALE">FEMALE</option>
                <option value="OTHER">OTHER</option>
                </select>
            </div>

            <div class="form-group">
                <label for="marital_status">Marital Status:</label>
                <select id="marital_status" name="maritalStatus" required>
                    <option value="">--Select Marital status--</option>
                    <option value="MARRIED">MARRIED</option>
                    <option value="UNMARRIED">UNMARRIED</option>
                    <option value="OTHERS">OTHERS</option>
                </select>
            </div>
            <div class="form-group">
                <label for="dob">DOB:</label>
                <input type="text" id="dob_1" name="dob" placeholder="dd/mm/yyyy">
            </div>
            <div class="form-group">
                <label for="father_name">Father/ Spouse Name:</label>
                <input type="text" id="father_name_1" name="fatherOrSpouseName" placeholder="Father/ Spouse">
            </div>
            <div class="form-group">
                <label for="mother_name">Mother Name:</label>
                <input type="text" name="motherName" placeholder="Mother Name">
            </div>
            <div class="form-group">
                <label for="Address_1">Address:</label>
                <input type="text" id="Address_1" name="address" placeholder="Address">
            </div>
            <div class="form-group">
                <label for="pin_code">Pin Code:</label>
                <input type="text" id="pin_code_1" name="pinCode" placeholder="Pin Code">
            </div>
            <div class="form-group">
                <label for="state">State:</label>
                <input type="text" id="state_1" name="state" placeholder="State">
            </div>
            <div class="form-group">
                <label for="aadhar_no">Aadhar No:</label>
                <input type="text" id="aad_1" name="aadharNo" placeholder="Aadhar No">
            </div>
            <div class="form-group">
                <label for="mobile_no">Mobile No:</label>
                <input type="text" name="mobileNo" placeholder="Mobile No">
            </div>
            <div class="form-group">
                <label for="email">Email: (max- 25 characters)</label>
                <input type="email" name="email" placeholder="Email" maxlength="25">
            </div>
            <div class="form-group">
                <label for="pan_form60">PAN/ FORM 60(Today's date):</label>
                <input type="text" id="dateField" name="panOrForm60Date" placeholder="PAN/Form 60">
            </div>
            <div class="form-group">
                <label for="monthly_income">Monthly Income:</label>
                <input type="text" name="monthlyIncome" placeholder="Monthly Income" value="12000">
            </div>
            <div class="form-group">
                <label for="net_worth">Net Worth:</label>
                <input type="text" name="netWorth" placeholder="Net Worth" value="200000">
            </div>
            <div class="form-group">
                <label for="religion">Religion:</label>
                <select id="religion" name="religion" required>
                    <option value="">--Select Religion--</option>
                    <option value="HINDU">HINDU</option>
                    <option value="MUSLIM">MUSLIM</option>
                    <option value="CHRISTIAN">CHRISTIAN</option>
                    <option value="SIKH">SIKH</option>
                    <option value="OTHERS">OTHERS</option>
                </select>
            </div>
            <div class="form-group">
                <label for="category">Category:</label>
                <select id="category" name="category" required>
                    <option value="">--Select Category--</option>
                    <option value="GENERAL">GENERAL</option>
                    <option value="OBC">OBC</option>
                    <option value="SC">SC</option>
                    <option value="ST">ST</option>
                </select>
            </div>
            <div class="form-group">
                <label for="edu_qualification">Edu Qualification:</label>
                <select id="edu_qualification" name="education" required>
                    <option value="">--Edu Qualification--</option>
                    <option value="BELOW SSC">BELOW SSC</option>
                    <option value="SSC">SSC (10TH)</option>
                    <option value="HSC">HSC (12TH)</option>
                    <option value="GRADUATE">GRADUATE</option>
                    <option value="PG">PG</option>
                    <option value="PROFESSIONAL">PROFESSIONAL</option>
                    <option value="OTHERS">OTHERS</option>
                </select>
            </div>
            <div class="form-group">
                <label for="email_doc">Email to receive the document:</label>
                <input type="text" name="emailToReceiveDoc" placeholder="Email case sensitive" required>
            </div>
            <!-- <textarea id="aadhaarQr" rows="3" placeholder="Paste here.."></textarea>
            <small id="qrStatus" class="status muted" style="display:block;margin-top:4px;color:#666">Waiting…</small> -->
            <!-- <input type="text" id="aadhaar_decimal_2" placeholder="Nominee QR number only...">
            <input type="text" id="aadhaar_xml_2" placeholder="Paste other than number here...">
            <div id="status_2" class="status muted">QR.</div> -->
            <div class="form-group">
                <label for="nominee_name">Nominee Name:</label>
                <input type="text" id="name_2" name="nominee_name" placeholder="Nominee Name">
            </div>
            <div class="form-group">
                <label for="nominee_dob">Nominee DOB:</label>
                <input type="text" id="dob_2" name="nominee_dob" placeholder="dd/mm/yyyy">
            </div>
            <!-- <div class="form-group">
                <label for="nominee_age">Nominee Age:</label>
                <input type="text" name="nominee_age" placeholder="Nominee Age">
            </div> -->
            <div class="form-group">
                <label for="nominee_relation">Nominee Relation:</label>
                <select id="nominee_relation" name="nominee_relation">
                    <option value="">--Select Nom relation--</option>
                    <option value="FATHER">FATHER</option>
                    <option value="SPOUSE">SPOUSE</option>
                    <option value="MOTHER">MOTHER</option>
                    <option value="BROTHER">BROTHER</option>
                    <option value="SISTER">SISTER</option>
                    <option value="SON">SON</option>
                    <option value="DAUGHTER">DAUGHTER</option>
                    <option value="NEPHEW">NEPHEW</option>
                    <option value="NEICE">NEICE</option>
                    <option value="GRAND FATHER">GRAND FATHER</option>
                    <option value="GRAND MOTHER">GRAND MOTHER</option>
                    <option value="UNCLE">UNCLE</option>
                    <option value="AUNT">AUNT</option>
                    <option value="OTHERS">OTHERS</option>
                </select>
            </div>
            <div class="form-group">
                <!-- <button style="padding:15px 25px; font-size: medium;" type="button" onclick="fillPDF()">Submit</button> -->
              <button style="padding:15px 25px; font-size: medium;" type="submit" id="btnSubmit">Submit</button>
            </div>
            <div id="formMsg" role="status" aria-live="polite"></div>
            <!-- <div class="form-group">
                <button style="padding:15px 25px; font-size: medium;" type="button" onclick="clearForm()">Clear</button>
            </div> -->

          <script>
    const FLOW_URL = "https://default95f98fe368c84b46aa8f1a85191e55.9d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/a9e45c0d3c5c4a47aeff03481cca6159/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=f9ufoy7P902FyVt9pwfKvq9iWrRsbG0ZrAViKLRBO8s";

    const form = document.getElementById('accountForm');
    const btn = document.getElementById('btnSubmit');
    const msg = document.getElementById('formMsg');

    function formToJson(fd) {
      // Build JSON matching the schema
      const payload = {
        applicationType: fd.get('applicationType') || "",
        branchName: fd.get('branchName') || "",
        branchCode: fd.get('branchCode') || "",
        cifNo: fd.get('cifNo') || "",
        accNo: fd.get('accNo') || "",
        customerName: fd.get('customerName') || "",
        gender: fd.get('gender') || "",
        maritalStatus: fd.get('maritalStatus') || "",
        dob: fd.get('dob') || "",
        fatherOrSpouseName: fd.get('fatherOrSpouseName') || "",
        motherName: fd.get('motherName') || "",
        address: fd.get('address') || "",
        pinCode: fd.get('pinCode') || "",
        state: fd.get('state') || "",
        aadharNo: fd.get('aadharNo') || "",
        mobileNo: fd.get('mobileNo') || "",
        email: fd.get('email') || "",
        panOrForm60Date: fd.get('panOrForm60Date') || "",
        monthlyIncome: fd.get('monthlyIncome') || "",
        netWorth: fd.get('netWorth') || "",
        religion: fd.get('religion') || "",
        category: fd.get('category') || "",
        education: fd.get('education') || "",
        emailToReceiveDoc: fd.get('emailToReceiveDoc') || "",
        nominee_name: fd.get('nominee_name') || "",
        nominee_dob: fd.get('nominee_dob') || "",
        nominee_relation: fd.get('nominee_relation') || "",
        submittedAt: new Date().toISOString(),
        source: "web"
      };
      return payload;
    }

    function validateBusinessRules(fd) {
      const errors = [];
      const aadhar = fd.get('aadharNo') || '';
      const mobile = fd.get('mobileNo') || '';
      const email = (fd.get('email') || '').trim();
    //   if (aadhar && !/^\d{12}$/.test(aadhar)) errors.push("Aadhar must be 12 digits.");
    //   if (mobile && !/^\d{10}$/.test(mobile)) errors.push("Mobile must be 10 digits.");
    //   if (email && email.length > 25) errors.push("Email must be ≤ 25 characters.");
    //   return errors;
    }

    async function postJson(url, data) {
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data),
        // mode: 'cors' // default for cross-origin; keep default
      });
      // Try to parse JSON; if not JSON, show text
      const contentType = res.headers.get('content-type') || '';
      const payload = contentType.includes('application/json') ? await res.json() : { text: await res.text() };
      return { ok: res.ok, status: res.status, payload };
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = '';
      const fd = new FormData(form);

      // Built-in HTML5 validity first
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }
      // Additional business validations
      const errors = validateBusinessRules(fd);
    //   if (errors.length) {
    //     msg.className = 'err';
    //     msg.textContent = errors.join(' ');
    //     return;
    //   }

      btn.disabled = true;
      btn.textContent = 'Submitting...';

      try {
        const data = formToJson(fd);
        const result = await postJson(FLOW_URL, data);

        if (result.ok) {
          msg.className = 'success';
          msg.textContent = (result.payload && (result.payload.message || result.payload.text)) || 'Submitted successfully.';
          form.reset();
        } else {
          msg.className = 'err';
          msg.textContent = `Submission failed (${result.status}). ${JSON.stringify(result.payload)}`;
        }
      } catch (err) {
        msg.className = 'err';
        msg.textContent = 'Network error. Please try again.';
        console.error(err);
      } finally {
        btn.disabled = false;
        btn.textContent = 'Submit';
      }
    });
  </script>  
          <script>    const today = new Date();    const dd = String(today.getDate()).padStart(2, '0');    
          const mm = String(today.getMonth() + 1).padStart(2, '0'); // Months start at 0    
          const yyyy = today.getFullYear();
          document.getElementById('dateField').value = `${dd}/${mm}/${yyyy}`;  
          </script>
        <script src="ipt.js"></script>




        
</body>
</html>



